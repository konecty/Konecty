{
	"info": {
		"_postman_id": "konecty-api-collection",
		"name": "Konecty API",
		"description": "Postman collection for Konecty API endpoints including OTP authentication",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "apikey",
		"apikey": [
			{ "key": "key", "value": "Authorization", "type": "string" },
			{ "key": "value", "value": "{{authToken}}", "type": "string" },
			{ "key": "in", "value": "header", "type": "string" }
		]
	},
	"item": [
		{
			"name": "Authentication",
			"item": [
				{
					"name": "Login",
					"request": {
						"auth": { "type": "noauth" },
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user\": \"user@example.com\",\n  \"password\": \"yourPassword\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/rest/auth/login",
							"host": ["{{baseUrl}}"],
							"path": ["rest", "auth", "login"]
						},
						"description": "Authenticate user with email/username and password"
					},
					"response": [
						{
							"name": "Success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user\": \"user@example.com\",\n  \"password\": \"yourPassword\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/rest/auth/login",
									"host": ["{{baseUrl}}"],
									"path": ["rest", "auth", "login"]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [],
							"cookie": [],
							"body": "{\n  \"success\": true,\n  \"authId\": \"<token>\",\n  \"user\": {\n    \"_id\": \"user-id\",\n    \"name\": \"User Name\",\n    \"email\": \"user@example.com\"\n  },\n  \"cookieMaxAge\": 2592000\n}"
						}
					]
				},
				{
					"name": "OTP Authentication",
					"item": [
						{
							"name": "Request OTP - Phone",
							"request": {
								"auth": { "type": "noauth" },
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"phoneNumber\": \"+5511999999999\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/auth/request-otp",
									"host": ["{{baseUrl}}"],
									"path": ["api", "auth", "request-otp"]
								},
								"description": "Request OTP via phone number. OTP will be sent via WhatsApp (if configured), RabbitMQ, or Email as fallback.\n\n**Phone Number Format:** E.164 format (e.g., +5511999999999)\n\n**Rate Limit:** Maximum 5 requests per minute per phone number"
							},
							"response": [
								{
									"name": "Success - WhatsApp",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"+5511999999999\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/request-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "request-otp"]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": true,\n  \"message\": \"OTP sent via whatsapp\"\n}"
								},
								{
									"name": "Success - Email Fallback",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"+5511999999999\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/request-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "request-otp"]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": true,\n  \"message\": \"OTP sent via email\"\n}"
								},
								{
									"name": "User Not Found",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"+5511999999999\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/request-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "request-otp"]
										}
									},
									"status": "Not Found",
									"code": 404,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": false,\n  \"errors\": [\n    {\n      \"message\": \"User not found for this phone number\"\n    }\n  ]\n}"
								},
								{
									"name": "Rate Limit Exceeded",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"+5511999999999\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/request-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "request-otp"]
										}
									},
									"status": "Too Many Requests",
									"code": 429,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": false,\n  \"errors\": [\n    {\n      \"message\": \"Too many requests. Please try again later.\"\n    }\n  ]\n}"
								},
								{
									"name": "Invalid Phone Format",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"5511999999999\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/request-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "request-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": false,\n  \"errors\": [\n    {\n      \"message\": \"Invalid phone number format. Must be in E.164 format (e.g., +5511999999999)\"\n    }\n  ]\n}"
								}
							]
						},
						{
							"name": "Request OTP - Email",
							"request": {
								"auth": { "type": "noauth" },
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"email\": \"user@example.com\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/auth/request-otp",
									"host": ["{{baseUrl}}"],
									"path": ["api", "auth", "request-otp"]
								},
								"description": "Request OTP via email. OTP will be sent directly via email (skips WhatsApp).\n\n**Rate Limit:** Maximum 5 requests per minute per email address"
							},
							"response": [
								{
									"name": "Success",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"email\": \"user@example.com\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/request-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "request-otp"]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": true,\n  \"message\": \"OTP sent via email\"\n}"
								}
							]
						},
						{
							"name": "Verify OTP - Phone",
							"request": {
								"auth": { "type": "noauth" },
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"phoneNumber\": \"+5511999999999\",\n  \"otpCode\": \"123456\",\n  \"geolocation\": {\n    \"longitude\": -46.633309,\n    \"latitude\": -23.550520\n  },\n  \"resolution\": {\n    \"width\": 1920,\n    \"height\": 1080\n  },\n  \"source\": \"mobile-app\",\n  \"fingerprint\": \"device-fingerprint-hash\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/auth/verify-otp",
									"host": ["{{baseUrl}}"],
									"path": ["api", "auth", "verify-otp"]
								},
								"description": "Verify OTP code and authenticate user via phone number.\n\n**OTP Details:**\n- 6-digit code\n- Expires after configurable time (default: 5 minutes)\n- Maximum 3 verification attempts\n- OTP is single-use (deleted after successful verification)\n\n**Optional Fields (same as traditional login):**\n- `geolocation`: { longitude: number, latitude: number } or JSON string\n- `resolution`: { width: number, height: number } or JSON string\n- `source`: string (e.g., 'mobile-app', 'web')\n- `fingerprint`: string (device fingerprint hash)\n\nThese fields are recorded in AccessLog for audit and security purposes."
							},
							"response": [
								{
									"name": "Success",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"+5511999999999\",\n  \"otpCode\": \"123456\",\n  \"geolocation\": {\n    \"longitude\": -46.633309,\n    \"latitude\": -23.550520\n  },\n  \"resolution\": {\n    \"width\": 1920,\n    \"height\": 1080\n  },\n  \"source\": \"mobile-app\",\n  \"fingerprint\": \"device-fingerprint-hash\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/verify-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "verify-otp"]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": true,\n  \"logged\": true,\n  \"authId\": \"<token>\",\n  \"user\": {\n    \"_id\": \"user-id\",\n    \"name\": \"User Name\",\n    \"email\": \"user@example.com\",\n    \"group\": {\n      \"_id\": \"group-id\",\n      \"name\": \"Group Name\"\n    },\n    \"locale\": \"pt-BR\",\n    \"namespace\": \"default\"\n  }\n}"
								},
								{
									"name": "Invalid OTP Code",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"+5511999999999\",\n  \"otpCode\": \"000000\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/verify-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "verify-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": false,\n  \"errors\": [\n    {\n      \"message\": \"Invalid OTP code\"\n    }\n  ]\n}"
								},
								{
									"name": "OTP Expired",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"+5511999999999\",\n  \"otpCode\": \"123456\",\n  \"geolocation\": {\n    \"longitude\": -46.633309,\n    \"latitude\": -23.550520\n  },\n  \"resolution\": {\n    \"width\": 1920,\n    \"height\": 1080\n  },\n  \"source\": \"mobile-app\",\n  \"fingerprint\": \"device-fingerprint-hash\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/verify-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "verify-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": false,\n  \"errors\": [\n    {\n      \"message\": \"OTP not found or expired. Please request a new OTP.\"\n    }\n  ]\n}"
								},
								{
									"name": "Max Attempts Exceeded",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phoneNumber\": \"+5511999999999\",\n  \"otpCode\": \"123456\",\n  \"geolocation\": {\n    \"longitude\": -46.633309,\n    \"latitude\": -23.550520\n  },\n  \"resolution\": {\n    \"width\": 1920,\n    \"height\": 1080\n  },\n  \"source\": \"mobile-app\",\n  \"fingerprint\": \"device-fingerprint-hash\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/verify-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "verify-otp"]
										}
									},
									"status": "Bad Request",
									"code": 400,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": false,\n  \"errors\": [\n    {\n      \"message\": \"Maximum verification attempts exceeded. Please request a new OTP.\"\n    }\n  ]\n}"
								}
							]
						},
						{
							"name": "Verify OTP - Email",
							"request": {
								"auth": { "type": "noauth" },
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"email\": \"user@example.com\",\n  \"otpCode\": \"123456\",\n  \"geolocation\": {\n    \"longitude\": -46.633309,\n    \"latitude\": -23.550520\n  },\n  \"resolution\": {\n    \"width\": 1920,\n    \"height\": 1080\n  },\n  \"source\": \"web\",\n  \"fingerprint\": \"device-fingerprint-hash\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/api/auth/verify-otp",
									"host": ["{{baseUrl}}"],
									"path": ["api", "auth", "verify-otp"]
								},
								"description": "Verify OTP code and authenticate user via email.\n\n**OTP Details:**\n- 6-digit code\n- Expires after configurable time (default: 5 minutes)\n- Maximum 3 verification attempts\n- OTP is single-use (deleted after successful verification)\n\n**Optional Fields (same as traditional login):**\n- `geolocation`: { longitude: number, latitude: number } or JSON string\n- `resolution`: { width: number, height: number } or JSON string\n- `source`: string (e.g., 'mobile-app', 'web')\n- `fingerprint`: string (device fingerprint hash)\n\nThese fields are recorded in AccessLog for audit and security purposes."
							},
							"response": [
								{
									"name": "Success",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"email\": \"user@example.com\",\n  \"otpCode\": \"123456\"\n}"
										},
										"url": {
											"raw": "{{baseUrl}}/api/auth/verify-otp",
											"host": ["{{baseUrl}}"],
											"path": ["api", "auth", "verify-otp"]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [],
									"cookie": [],
									"body": "{\n  \"success\": true,\n  \"logged\": true,\n  \"authId\": \"<token>\",\n  \"user\": {\n    \"_id\": \"user-id\",\n    \"name\": \"User Name\",\n    \"email\": \"user@example.com\",\n    \"group\": {\n      \"_id\": \"group-id\",\n      \"name\": \"Group Name\"\n    },\n    \"locale\": \"pt-BR\",\n    \"namespace\": \"default\"\n  }\n}"
								}
							]
						}
					]
				}
			]
		},
		{
			"name": "Data Streaming",
			"item": [
				{
					"name": "Find Stream",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/rest/stream/Opportunity/findStream?filter={\"status\":{\"$in\":[\"Nova\",\"Em Visitação\"]}}&limit=100&sort=[{\"property\":\"_id\",\"direction\":\"ASC\"}]",
							"host": ["{{baseUrl}}"],
							"path": ["rest", "stream", ":document", "findStream"],
							"query": [
								{
									"key": "filter",
									"value": "{\"status\":{\"$in\":[\"Nova\",\"Em Visitação\"]}}",
									"description": "Filter in JSON format"
								},
								{
									"key": "limit",
									"value": "100",
									"description": "Maximum number of records to return (default: 50)"
								},
								{
									"key": "start",
									"value": "0",
									"description": "Start index of results (default: 0)",
									"disabled": true
								},
								{
									"key": "sort",
									"value": "[{\"property\":\"_id\",\"direction\":\"ASC\"}]",
									"description": "Sorting in JSON format"
								},
								{
									"key": "fields",
									"value": "",
									"description": "Fields to return, comma-separated (optional)",
									"disabled": true
								},
								{
									"key": "displayName",
									"value": "",
									"description": "Display name to use (optional)",
									"disabled": true
								},
								{
									"key": "displayType",
									"value": "",
									"description": "Display type to use (optional)",
									"disabled": true
								},
								{
									"key": "withDetailFields",
									"value": "",
									"description": "Whether to include detail fields (optional)",
									"disabled": true
								}
							],
							"variable": [
								{
									"key": "document",
									"value": "Opportunity",
									"description": "Module name (e.g., Opportunity, Contact)"
								}
							]
						},
						"description": "Find records with HTTP streaming. Returns data in newline-delimited JSON (NDJSON) format, sent incrementally without accumulating in server memory.\n\n**Advantages over `/rest/data/:document/find`:**\n- 68% reduction in server memory usage\n- 99.3% faster TTFB (client receives data immediately)\n- 81.8% better throughput\n- Supports much larger volumes (50k+ records) without memory impact\n\n**Response Format:**\n- Content-Type: `application/json`\n- Transfer-Encoding: `chunked`\n- Format: Newline-delimited JSON (one record per line)\n\n**When to use:**\n- Large data volumes (1000+ records)\n- When client needs to process data incrementally\n- When low TTFB is critical\n- When there are server memory limitations\n\n**Default Sorting:**\nIf not specified, applies `{ _id: 1 }` to ensure consistency."
					},
					"response": [
						{
							"name": "Stream Success",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "{{authToken}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/rest/stream/Opportunity/findStream?filter={\"status\":{\"$in\":[\"Nova\",\"Em Visitação\"]}}&limit=100",
									"host": ["{{baseUrl}}"],
									"path": ["rest", "stream", "Opportunity", "findStream"],
									"query": [
										{
											"key": "filter",
											"value": "{\"status\":{\"$in\":[\"Nova\",\"Em Visitação\"]}}"
										},
										{
											"key": "limit",
											"value": "100"
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "text",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Transfer-Encoding",
									"value": "chunked"
								}
							],
							"cookie": [],
							"body": "{\"_id\":\"001\",\"name\":\"Registro 1\",\"status\":\"Nova\",\"createdAt\":\"2024-01-01T00:00:00.000Z\"}\n{\"_id\":\"002\",\"name\":\"Registro 2\",\"status\":\"Em Visitação\",\"createdAt\":\"2024-01-02T00:00:00.000Z\"}\n{\"_id\":\"003\",\"name\":\"Registro 3\",\"status\":\"Nova\",\"createdAt\":\"2024-01-03T00:00:00.000Z\"}"
						},
						{
							"name": "Error Response",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "{{authToken}}"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/rest/stream/InvalidDocument/findStream",
									"host": ["{{baseUrl}}"],
									"path": ["rest", "stream", "InvalidDocument", "findStream"]
								}
							},
							"status": "Internal Server Error",
							"code": 500,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"success\": false,\n  \"errors\": [\n    {\n      \"message\": \"Oops something went wrong, please try again later... if this message persisits, please contact our support\"\n    }\n  ]\n}"
						}
					]
				},
				{
					"name": "Find Stream - Contact",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/rest/stream/Contact/findStream?limit=50",
							"host": ["{{baseUrl}}"],
							"path": ["rest", "stream", "Contact", "findStream"],
							"query": [
								{
									"key": "limit",
									"value": "50"
								}
							]
						},
						"description": "Find Contact records with streaming. Example with minimal parameters."
					},
					"response": []
				},
				{
					"name": "Find Stream - With Filter",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/rest/stream/Opportunity/findStream?filter={\"match\":\"and\",\"conditions\":[{\"field\":\"status\",\"operator\":\"in\",\"value\":[\"Nova\",\"Em Visitação\",\"Ofertando Imóveis\",\"Proposta\",\"Contrato\"]}]}&limit=1000",
							"host": ["{{baseUrl}}"],
							"path": ["rest", "stream", "Opportunity", "findStream"],
							"query": [
								{
									"key": "filter",
									"value": "{\"match\":\"and\",\"conditions\":[{\"field\":\"status\",\"operator\":\"in\",\"value\":[\"Nova\",\"Em Visitação\",\"Ofertando Imóveis\",\"Proposta\",\"Contrato\"]}]}"
								},
								{
									"key": "limit",
									"value": "1000"
								}
							]
						},
					"description": "Find Opportunity records with complex filter. Example filtering by multiple status values."
				},
				"response": []
			},
			{
				"name": "Pivot Table",
				"request": {
					"method": "GET",
					"header": [],
					"url": {
						"raw": "{{baseUrl}}/rest/data/Opportunity/pivot?filter={\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}&pivotConfig={\"rows\":[{\"field\":\"_user.director.nickname\",\"sort\":\"ASC\"},{\"field\":\"_user.group.name\",\"sort\":\"ASC\"},{\"field\":\"_user.name\",\"sort\":\"ASC\"}],\"columns\":[{\"field\":\"status\"}],\"values\":[{\"field\":\"code\",\"aggregator\":\"count\"},{\"field\":\"amount.value\",\"aggregator\":\"sum\"}]}",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "data", ":document", "pivot"],
						"query": [
							{
								"key": "filter",
								"value": "{\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}",
								"description": "Filter in JSON format"
							},
							{
								"key": "pivotConfig",
								"value": "{\"rows\":[{\"field\":\"_user.director.nickname\",\"sort\":\"ASC\"},{\"field\":\"_user.group.name\",\"sort\":\"ASC\"},{\"field\":\"_user.name\",\"sort\":\"ASC\"}],\"columns\":[{\"field\":\"status\"}],\"values\":[{\"field\":\"code\",\"aggregator\":\"count\"},{\"field\":\"amount.value\",\"aggregator\":\"sum\"}]}",
								"description": "Pivot table configuration in JSON format"
							},
							{
								"key": "limit",
								"value": "",
								"description": "Maximum number of records to process (optional)",
								"disabled": true
							},
							{
								"key": "sort",
								"value": "",
								"description": "Sorting in JSON format (optional)",
								"disabled": true
							}
						]
					},
					"description": "Generate pivot table from Opportunity records with hierarchical rows (director > group > user) and status columns, counting codes and summing amounts."
				},
				"response": [
					{
						"name": "Success",
						"originalRequest": {
							"method": "GET",
							"header": [
								{
									"key": "Authorization",
									"value": "{{authToken}}"
								}
							],
							"url": {
								"raw": "{{baseUrl}}/rest/data/Opportunity/pivot?filter={\"status\":{\"$in\":[\"Nova\",\"Em Visitação\"]}}&pivotConfig={\"rows\":[{\"field\":\"status\"}],\"columns\":[{\"field\":\"type\"}],\"values\":[{\"field\":\"value\",\"aggregator\":\"sum\"}]}",
								"host": ["{{baseUrl}}"],
								"path": ["rest", "data", "Opportunity", "pivot"],
								"query": [
									{
										"key": "filter",
										"value": "{\"status\":{\"$in\":[\"Nova\",\"Em Visitação\"]}}"
									},
									{
										"key": "pivotConfig",
										"value": "{\"rows\":[{\"field\":\"status\"}],\"columns\":[{\"field\":\"type\"}],\"values\":[{\"field\":\"value\",\"aggregator\":\"sum\"}]}"
									}
								]
							}
						},
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"cookie": [],
						"body": "{\n  \"success\": true,\n  \"metadata\": {\n    \"rows\": [\n      {\n        \"field\": \"status\",\n        \"label\": \"Situação\",\n        \"type\": \"picklist\",\n        \"level\": 0\n      }\n    ],\n    \"columns\": [\n      {\n        \"field\": \"type\",\n        \"label\": \"Tipo\",\n        \"type\": \"picklist\",\n        \"values\": [\n          { \"key\": \"Residencial\", \"label\": \"Residencial\" },\n          { \"key\": \"Comercial\", \"label\": \"Comercial\" }\n        ]\n      }\n    ],\n    \"values\": [\n      {\n        \"field\": \"value\",\n        \"aggregator\": \"sum\",\n        \"label\": \"Valor\",\n        \"type\": \"money\",\n        \"format\": \"currency\"\n      }\n    ]\n  },\n  \"data\": [\n    {\n      \"key\": \"Nova\",\n      \"label\": \"Nova\",\n      \"level\": 0,\n      \"cells\": {\n        \"Residencial\": { \"value\": 150000 },\n        \"Comercial\": { \"value\": 200000 }\n      },\n      \"totals\": { \"value\": 350000 },\n      \"children\": []\n    },\n    {\n      \"key\": \"Em Visitação\",\n      \"label\": \"Em Visitação\",\n      \"level\": 0,\n      \"cells\": {\n        \"Residencial\": { \"value\": 300000 },\n        \"Comercial\": { \"value\": 250000 }\n      },\n      \"totals\": { \"value\": 550000 },\n      \"children\": []\n    }\n  ],\n  \"grandTotals\": {\n    \"cells\": {\n      \"Residencial\": { \"value\": 450000 },\n      \"Comercial\": { \"value\": 450000 }\n    },\n    \"totals\": { \"value\": 900000 }\n  },\n  \"total\": 2\n}"
					},
					{
						"name": "Error - Missing pivotConfig",
						"originalRequest": {
							"method": "GET",
							"header": [
								{
									"key": "Authorization",
									"value": "{{authToken}}"
								}
							],
							"url": {
								"raw": "{{baseUrl}}/rest/data/Opportunity/pivot",
								"host": ["{{baseUrl}}"],
								"path": ["rest", "data", "Opportunity", "pivot"]
							}
						},
						"status": "Bad Request",
						"code": 400,
						"_postman_previewlanguage": "json",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"cookie": [],
						"body": "{\n  \"success\": false,\n  \"errors\": [\n    {\n      \"message\": \"[Opportunity] pivotConfig is required\"\n    }\n  ]\n}"
					}
				]
			},
			{
				"name": "Graph - Bar Chart by Status",
				"request": {
					"method": "GET",
					"header": [],
					"url": {
						"raw": "{{baseUrl}}/rest/data/Opportunity/graph?filter={\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}&graphConfig={\"type\":\"bar\",\"categoryField\":\"status\",\"aggregation\":\"count\",\"xAxis\":{\"field\":\"status\",\"label\":\"Status\"},\"yAxis\":{\"field\":\"code\",\"label\":\"Quantidade\"},\"title\":\"Oportunidades por Status\"}",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "data", "Opportunity", "graph"],
						"query": [
							{
								"key": "filter",
								"value": "{\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}",
								"description": "Filter in JSON format"
							},
							{
								"key": "graphConfig",
								"value": "{\"type\":\"bar\",\"categoryField\":\"status\",\"aggregation\":\"count\",\"xAxis\":{\"field\":\"status\",\"label\":\"Status\"},\"yAxis\":{\"field\":\"code\",\"label\":\"Quantidade\"},\"title\":\"Oportunidades por Status\"}",
								"description": "Graph configuration in JSON format"
							}
						]
					},
					"description": "Generate bar chart showing count of opportunities by status. Uses Polars for fast aggregation."
				},
				"response": []
			},
			{
				"name": "Graph - Bar Chart by Status (Sum Values)",
				"request": {
					"method": "GET",
					"header": [],
					"url": {
						"raw": "{{baseUrl}}/rest/data/Opportunity/graph?filter={\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}&graphConfig={\"type\":\"bar\",\"categoryField\":\"status\",\"aggregation\":\"sum\",\"xAxis\":{\"field\":\"status\",\"label\":\"Status\"},\"yAxis\":{\"field\":\"amount.value\",\"label\":\"Valor Total\"},\"title\":\"Valor Total por Status\"}",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "data", "Opportunity", "graph"],
						"query": [
							{
								"key": "filter",
								"value": "{\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}",
								"description": "Filter in JSON format"
							},
							{
								"key": "graphConfig",
								"value": "{\"type\":\"bar\",\"categoryField\":\"status\",\"aggregation\":\"sum\",\"xAxis\":{\"field\":\"status\",\"label\":\"Status\"},\"yAxis\":{\"field\":\"amount.value\",\"label\":\"Valor Total\"},\"title\":\"Valor Total por Status\"}",
								"description": "Graph configuration in JSON format"
							}
						]
					},
					"description": "Generate bar chart showing sum of amount.value by status."
				},
				"response": []
			},
			{
				"name": "Graph - Bar Chart by Director",
				"request": {
					"method": "GET",
					"header": [],
					"url": {
						"raw": "{{baseUrl}}/rest/data/Opportunity/graph?filter={\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}&graphConfig={\"type\":\"bar\",\"categoryField\":\"_user.director.nickname\",\"aggregation\":\"count\",\"xAxis\":{\"field\":\"_user.director.nickname\",\"label\":\"Diretor\"},\"yAxis\":{\"field\":\"code\",\"label\":\"Quantidade\"},\"title\":\"Oportunidades por Diretor\"}",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "data", "Opportunity", "graph"],
						"query": [
							{
								"key": "filter",
								"value": "{\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}",
								"description": "Filter in JSON format"
							},
							{
								"key": "graphConfig",
								"value": "{\"type\":\"bar\",\"categoryField\":\"_user.director.nickname\",\"aggregation\":\"count\",\"xAxis\":{\"field\":\"_user.director.nickname\",\"label\":\"Diretor\"},\"yAxis\":{\"field\":\"code\",\"label\":\"Quantidade\"},\"title\":\"Oportunidades por Diretor\"}",
								"description": "Graph configuration in JSON format"
							}
						]
					},
					"description": "Generate bar chart showing count of opportunities by director nickname."
				},
				"response": []
			},
			{
				"name": "Graph - Pie Chart",
				"request": {
					"method": "GET",
					"header": [],
					"url": {
						"raw": "{{baseUrl}}/rest/data/Opportunity/graph?filter={\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}&graphConfig={\"type\":\"pie\",\"categoryField\":\"status\",\"aggregation\":\"count\",\"yAxis\":{\"field\":\"code\"},\"title\":\"Distribuição por Status\"}",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "data", "Opportunity", "graph"],
						"query": [
							{
								"key": "filter",
								"value": "{\"status\":{\"$in\":[\"Nova\",\"Em Visitação\",\"Contrato\",\"Ofertando Imóveis\",\"Proposta\"]}}",
								"description": "Filter in JSON format"
							},
							{
								"key": "graphConfig",
								"value": "{\"type\":\"pie\",\"categoryField\":\"status\",\"aggregation\":\"count\",\"yAxis\":{\"field\":\"code\"},\"title\":\"Distribuição por Status\"}",
								"description": "Graph configuration in JSON format"
							}
						]
					},
					"description": "Generate pie chart showing distribution of opportunities by status."
				},
				"response": []
			}
		]
	}
,
	{
		"name": "Cross-Module Query",
		"description": "RFC-0001: Cross-module query API with recursive relations and aggregations. Uses Python/Polars as single aggregation engine. Defaults: includeTotal=true (sends X-Total-Count header), includeMeta=false (omits _meta NDJSON line). Set includeMeta=true to receive _meta with total, warnings, and execution info. Errors always use _meta wrapper.",
		"item": [
			{
				"name": "Example 1: Product + PPO (push + count)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Product\",\n  \"filter\": {\n    \"match\": \"and\",\n    \"conditions\": [{ \"term\": \"_id\", \"operator\": \"equals\", \"value\": \"fFaJkGaWAdDhvcPH6\" }]\n  },\n  \"fields\": \"code,type\",\n  \"limit\": 1,\n  \"includeMeta\": true,\n  \"relations\": [\n    {\n      \"document\": \"ProductsPerOpportunities\",\n      \"lookup\": \"product\",\n      \"fields\": \"status,situation,rating,contact\",\n      \"sort\": [{ \"property\": \"_createdAt\", \"direction\": \"DESC\" }],\n      \"limit\": 100,\n      \"aggregators\": {\n        \"offers\": { \"aggregator\": \"push\" },\n        \"offerCount\": { \"aggregator\": \"count\" }\n      }\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "RFC-0001 Example 1: Get a product and all its related offers (ProductsPerOpportunities) using push and count aggregators."
				},
				"response": [
					{
						"name": "Success",
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [{ "key": "Content-Type", "value": "application/x-ndjson" }, { "key": "X-Total-Count", "value": "1" }],
						"body": "{\"_meta\":{\"success\":true,\"document\":\"Product\",\"relations\":[\"ProductsPerOpportunities\"],\"warnings\":[],\"executionTimeMs\":234,\"total\":1}}\n{\"code\":123,\"type\":\"Apartamento\",\"offers\":[{\"_id\":\"x1\",\"status\":\"Ofertado\",\"rating\":4,\"contact\":{\"_id\":\"c1\",\"name\":{\"full\":\"John Doe\"}}},{\"_id\":\"x2\",\"status\":\"Visitado\",\"rating\":5,\"contact\":{\"_id\":\"c2\",\"name\":{\"full\":\"Jane Doe\"}}}],\"offerCount\":2}"
					}
				]
			},
			{
				"name": "Example 2: Contact + Opportunity (count)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Contact\",\n  \"fields\": \"code,name\",\n  \"sort\": [{ \"property\": \"name.full\", \"direction\": \"ASC\" }],\n  \"limit\": 1000,\n  \"includeMeta\": true,\n  \"relations\": [\n    {\n      \"document\": \"Opportunity\",\n      \"lookup\": \"contact\",\n      \"filter\": {\n        \"match\": \"and\",\n        \"conditions\": [{ \"term\": \"status\", \"operator\": \"in\", \"value\": [\"Nova\", \"Ofertando Imveis\", \"Em Visitacao\"] }]\n      },\n      \"aggregators\": {\n        \"activeOpportunities\": { \"aggregator\": \"count\" }\n      }\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "RFC-0001 Example 2: Count active opportunities per contact."
				},
				"response": [
					{
						"name": "Success",
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [{ "key": "Content-Type", "value": "application/x-ndjson" }, { "key": "X-Total-Count", "value": "42" }],
						"body": "{\"_meta\":{\"success\":true,\"document\":\"Contact\",\"relations\":[\"Opportunity\"],\"warnings\":[],\"executionTimeMs\":156,\"total\":42}}\n{\"code\":1001,\"name\":{\"full\":\"Alice Santos\"},\"activeOpportunities\":3}\n{\"code\":1002,\"name\":{\"full\":\"Bruno Silva\"},\"activeOpportunities\":1}"
					}
				]
			},
			{
				"name": "Example 3: Recursive - Contact + Opportunity + PPO",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Contact\",\n  \"filter\": {\n    \"match\": \"and\",\n    \"conditions\": [{ \"term\": \"status\", \"operator\": \"equals\", \"value\": \"active\" }]\n  },\n  \"fields\": \"code,name\",\n  \"limit\": 100,\n  \"includeMeta\": true,\n  \"relations\": [\n    {\n      \"document\": \"Opportunity\",\n      \"lookup\": \"contact\",\n      \"filter\": {\n        \"match\": \"and\",\n        \"conditions\": [{ \"term\": \"status\", \"operator\": \"in\", \"value\": [\"Nova\", \"Em Visitacao\"] }]\n      },\n      \"fields\": \"code,status,label\",\n      \"sort\": [{ \"property\": \"_createdAt\", \"direction\": \"DESC\" }],\n      \"limit\": 20,\n      \"aggregators\": {\n        \"opportunities\": { \"aggregator\": \"push\" },\n        \"opportunityCount\": { \"aggregator\": \"count\" }\n      },\n      \"relations\": [\n        {\n          \"document\": \"ProductsPerOpportunities\",\n          \"lookup\": \"opportunity\",\n          \"fields\": \"status,rating,product\",\n          \"limit\": 50,\n          \"aggregators\": {\n            \"products\": { \"aggregator\": \"push\" },\n            \"productCount\": { \"aggregator\": \"count\" }\n          }\n        }\n      ]\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "RFC-0001 Example 3: 3-level recursive chain - Contact -> Opportunity -> ProductsPerOpportunities."
				},
				"response": [
					{
						"name": "Success",
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [{ "key": "Content-Type", "value": "application/x-ndjson" }, { "key": "X-Total-Count", "value": "1" }],
						"body": "{\"_meta\":{\"success\":true,\"document\":\"Contact\",\"relations\":[\"Opportunity\",\"ProductsPerOpportunities\"],\"warnings\":[],\"executionTimeMs\":456,\"total\":1}}\n{\"code\":1001,\"name\":{\"full\":\"Alice Santos\"},\"opportunityCount\":2,\"opportunities\":[{\"code\":5001,\"status\":\"Nova\",\"label\":\"Apt 301\",\"productCount\":2,\"products\":[{\"status\":\"Ofertado\",\"rating\":4,\"product\":{\"_id\":\"p1\",\"code\":123}},{\"status\":\"Visitado\",\"rating\":5,\"product\":{\"_id\":\"p2\",\"code\":456}}]},{\"code\":5002,\"status\":\"Em Visitacao\",\"label\":\"Casa 12\",\"productCount\":0,\"products\":[]}]}"
					}
				]
			},
			{
				"name": "Example 4: Contact + Opportunity (first aggregator)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Contact\",\n  \"fields\": \"code,name\",\n  \"sort\": [{ \"property\": \"_createdAt\", \"direction\": \"DESC\" }],\n  \"limit\": 200,\n  \"includeMeta\": true,\n  \"relations\": [\n    {\n      \"document\": \"Opportunity\",\n      \"lookup\": \"contact\",\n      \"fields\": \"code,status,label\",\n      \"sort\": [{ \"property\": \"_createdAt\", \"direction\": \"DESC\" }],\n      \"limit\": 1,\n      \"aggregators\": {\n        \"firstOpportunityCode\": { \"aggregator\": \"first\", \"field\": \"code\" },\n        \"firstOpportunityStatus\": { \"aggregator\": \"first\", \"field\": \"status\" }\n      }\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "RFC-0001 Example 4: Contacts with their first (most recent) related opportunity (first aggregator). Uses Contact + Opportunity with lookup 'contact' (Opportunity.contact points to Contact), which is standard in Konecty. Contacts without opportunities get null for the aggregated fields."
				},
				"response": [
					{
						"name": "Success",
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [{ "key": "Content-Type", "value": "application/x-ndjson" }, { "key": "X-Total-Count", "value": "2" }],
						"body": "{\"_meta\":{\"success\":true,\"document\":\"Contact\",\"relations\":[\"Opportunity\"],\"warnings\":[],\"executionTimeMs\":123,\"total\":2}}\n{\"code\":1001,\"name\":{\"full\":\"Alice Santos\"},\"firstOpportunityCode\":5001,\"firstOpportunityStatus\":\"Nova\"}\n{\"code\":1002,\"name\":{\"full\":\"Bob Silva\"},\"firstOpportunityCode\":null,\"firstOpportunityStatus\":null}"
					}
				]
			},
			{
				"name": "Example 5: Campaign + Opportunity (count + first + avg)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Campaign\",\n  \"filter\": {\n    \"match\": \"and\",\n    \"conditions\": [{ \"term\": \"status\", \"operator\": \"equals\", \"value\": \"Ativo\" }]\n  },\n  \"fields\": \"code,name,type\",\n  \"limit\": 50,\n  \"includeMeta\": true,\n  \"relations\": [\n    {\n      \"document\": \"Opportunity\",\n      \"lookup\": \"campaign\",\n      \"sort\": [{ \"property\": \"_createdAt\", \"direction\": \"DESC\" }],\n      \"aggregators\": {\n        \"totalOpportunities\": { \"aggregator\": \"count\" },\n        \"newestOpportunity\": { \"aggregator\": \"first\" },\n        \"avgValue\": { \"aggregator\": \"avg\", \"field\": \"value\" }\n      }\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "RFC-0001 Example 5: Campaign performance with opportunity count, newest opportunity, and average value."
				},
				"response": [
					{
						"name": "Success",
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [{ "key": "Content-Type", "value": "application/x-ndjson" }, { "key": "X-Total-Count", "value": "3" }],
						"body": "{\"_meta\":{\"success\":true,\"document\":\"Campaign\",\"relations\":[\"Opportunity\"],\"warnings\":[],\"executionTimeMs\":200,\"total\":3}}\n{\"code\":301,\"name\":\"Summer 2026\",\"type\":\"Digital\",\"totalOpportunities\":45,\"newestOpportunity\":{\"_id\":\"o99\",\"code\":5099,\"status\":\"Nova\",\"label\":\"Lead #5099\"},\"avgValue\":250000}"
					}
				]
			},
			{
				"name": "Example 6: Contact + Message (max + count)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Contact\",\n  \"fields\": \"code,name\",\n  \"sort\": [{ \"property\": \"name.full\", \"direction\": \"ASC\" }],\n  \"limit\": 1000,\n  \"includeMeta\": true,\n  \"relations\": [\n    {\n      \"document\": \"Message\",\n      \"lookup\": \"contact\",\n      \"filter\": {\n        \"match\": \"and\",\n        \"conditions\": [\n          { \"term\": \"type\", \"operator\": \"equals\", \"value\": \"Email\" },\n          { \"term\": \"status\", \"operator\": \"equals\", \"value\": \"Enviada\" }\n        ]\n      },\n      \"aggregators\": {\n        \"lastEmailSentAt\": { \"aggregator\": \"max\", \"field\": \"_createdAt\" },\n        \"totalEmailsSent\": { \"aggregator\": \"count\" }\n      }\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "RFC-0001 Example 6: Last email sent date and total email count per contact."
				},
				"response": [
					{
						"name": "Success",
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [{ "key": "Content-Type", "value": "application/x-ndjson" }, { "key": "X-Total-Count", "value": "3" }],
						"body": "{\"_meta\":{\"success\":true,\"document\":\"Contact\",\"relations\":[\"Message\"],\"warnings\":[],\"executionTimeMs\":178,\"total\":3}}\n{\"code\":1001,\"name\":{\"full\":\"Alice Santos\"},\"lastEmailSentAt\":\"2026-02-09T14:30:00.000Z\",\"totalEmailsSent\":12}\n{\"code\":1002,\"name\":{\"full\":\"Bruno Silva\"},\"lastEmailSentAt\":\"2026-01-15T09:00:00.000Z\",\"totalEmailsSent\":3}\n{\"code\":1003,\"name\":{\"full\":\"Carlos Mendes\"},\"lastEmailSentAt\":null,\"totalEmailsSent\":0}"
					}
				]
			},
			{
				"name": "Example 7: Security Degradation (broker without Product access)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Opportunity\",\n  \"fields\": \"code,status,label\",\n  \"sort\": [{ \"property\": \"_createdAt\", \"direction\": \"DESC\" }],\n  \"limit\": 100,\n  \"includeMeta\": true,\n  \"relations\": [\n    {\n      \"document\": \"Product\",\n      \"lookup\": \"product\",\n      \"fields\": \"code,sale\",\n      \"aggregators\": {\n        \"productCode\": { \"aggregator\": \"first\", \"field\": \"code\" },\n        \"productSale\": { \"aggregator\": \"first\", \"field\": \"sale\" }\n      }\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "RFC-0001 Example 7: Security degradation. When a broker has no access to Product module, product aggregators return null and a warning is included in _meta."
				},
				"response": [
					{
						"name": "Success (with access warning)",
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [{ "key": "Content-Type", "value": "application/x-ndjson" }, { "key": "X-Total-Count", "value": "2" }],
						"body": "{\"_meta\":{\"success\":true,\"document\":\"Opportunity\",\"relations\":[\"Product\"],\"warnings\":[{\"type\":\"RELATION_ACCESS_DENIED\",\"document\":\"Product\",\"message\":\"User lacks read access to Product\"}],\"executionTimeMs\":98,\"total\":2}}\n{\"code\":5001,\"status\":\"Nova\",\"label\":\"Apt 301 - Centro\",\"productCode\":null,\"productSale\":null}\n{\"code\":5002,\"status\":\"Em Visitacao\",\"label\":\"Casa 12 - Praia\",\"productCode\":null,\"productSale\":null}"
					}
				]
			},
			{
				"name": "Invalid Query (validation error)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Contact\",\n  \"relations\": [\n    {\n      \"document\": \"Opportunity\",\n      \"lookup\": \"contact\",\n      \"aggregators\": {}\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "Negative test: Empty aggregators object should fail Zod validation."
				},
				"response": [
					{
						"name": "Validation Error",
						"status": "Bad Request",
						"code": 400,
						"_postman_previewlanguage": "json",
						"header": [{ "key": "Content-Type", "value": "application/x-ndjson" }],
						"body": "{\"_meta\":{\"success\":false,\"errors\":[{\"message\":\"relations.0.aggregators: At least one aggregator is required per relation\"}]}}"
					}
				]
			},
			{
				"name": "Empty Result (no matching records)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"document\": \"Contact\",\n  \"filter\": {\n    \"match\": \"and\",\n    \"conditions\": [{ \"term\": \"_id\", \"operator\": \"equals\", \"value\": \"nonexistent-id\" }]\n  },\n  \"fields\": \"code,name\",\n  \"limit\": 10,\n  \"includeTotal\": true,\n  \"includeMeta\": true,\n  \"relations\": [\n    {\n      \"document\": \"Opportunity\",\n      \"lookup\": \"contact\",\n      \"aggregators\": {\n        \"count\": { \"aggregator\": \"count\" }\n      }\n    }\n  ]\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/json",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "json"]
					},
					"description": "Edge case: Query that matches no primary records returns empty NDJSON with _meta."
				},
				"response": [
					{
						"name": "Empty Result",
						"status": "OK",
						"code": 200,
						"_postman_previewlanguage": "json",
						"header": [
							{ "key": "Content-Type", "value": "application/x-ndjson" },
							{ "key": "X-Total-Count", "value": "0" }
						],
						"body": "{\"_meta\":{\"success\":true,\"document\":\"Contact\",\"relations\":[\"Opportunity\"],\"warnings\":[],\"executionTimeMs\":45,\"total\":0}}"
					}
				]
			}
		]
	},
	{
		"name": "Cross-Module Query (SQL)",
		"description": "RFC-0001 Phase 2: Same cross-module queries via ANSI SQL subset. Endpoint: POST /rest/query/sql. Body: { \"sql\": \"SELECT ...\", \"includeTotal\": true, \"includeMeta\": false }. Defaults: includeTotal=true (sends X-Total-Count header), includeMeta=false (omits _meta NDJSON line). Set includeMeta=true to receive _meta with total, warnings, and execution info. Errors always use _meta wrapper. Response: NDJSON as per JSON endpoint. SQL is parsed and translated to the Internal Query Representation (IQR), then executed by the same engine as the JSON endpoint.",
		"item": [
			{
				"name": "SQL Example 1: Product + PPO (push + count)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"sql\": \"SELECT p.code, p.type, PUSH(ppo.*) AS offers, COUNT(ppo._id) AS offerCount FROM Product p INNER JOIN ProductsPerOpportunities ppo ON p._id = ppo.product._id WHERE p._id = 'fFaJkGaWAdDhvcPH6' GROUP BY p.code, p.type LIMIT 1\",\n  \"includeMeta\": true\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/sql",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "sql"]
					},
				"description": "RFC-0001 SQL equivalent of Example 1: Product with related offers (ProductsPerOpportunities). Same result as JSON Example 1."
			},
			"response": [
				{
					"name": "200 OK - NDJSON",
					"status": "OK",
					"code": 200,
					"header": [
						{ "key": "Content-Type", "value": "application/x-ndjson" },
						{ "key": "X-Total-Count", "value": "1" }
					],
					"body": "{\"_meta\":{\"success\":true,\"document\":\"Product\",\"relations\":[\"ProductsPerOpportunities\"],\"warnings\":[],\"executionTimeMs\":120,\"total\":1}}\n{\"code\":123,\"type\":\"Apartamento\",\"offers\":[{\"_id\":\"x1\",\"status\":\"Ofertado\",\"situation\":\"Visita\",\"rating\":4,\"contact\":{\"_id\":\"c1\",\"name\":{\"full\":\"John Doe\"}}},{\"_id\":\"x2\",\"status\":\"Visitado\",\"situation\":\"Proposta\",\"rating\":5,\"contact\":{\"_id\":\"c2\",\"name\":{\"full\":\"Jane Doe\"}}}],\"offerCount\":2}\n"
				}
			]
		},
			{
				"name": "SQL Example 2: Contact + Opportunity (count)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"sql\": \"SELECT c.code, c.name, COUNT(o._id) AS activeOpportunities FROM Contact c INNER JOIN Opportunity o ON c._id = o.contact._id WHERE o.status IN ('Nova', 'Ofertando Imveis', 'Em Visitacao') GROUP BY c.code, c.name ORDER BY c.name ASC LIMIT 1000\",\n  \"includeMeta\": true\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/sql",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "sql"]
					},
				"description": "RFC-0001 SQL equivalent of Example 2: Count active opportunities per contact."
			},
			"response": [
				{
					"name": "200 OK - NDJSON",
					"status": "OK",
					"code": 200,
					"header": [
						{ "key": "Content-Type", "value": "application/x-ndjson" },
						{ "key": "X-Total-Count", "value": "42" }
					],
					"body": "{\"_meta\":{\"success\":true,\"document\":\"Contact\",\"relations\":[\"Opportunity\"],\"warnings\":[],\"executionTimeMs\":234,\"total\":42}}\n{\"code\":1001,\"name\":{\"full\":\"Alice Santos\"},\"activeOpportunities\":3}\n{\"code\":1002,\"name\":{\"full\":\"Bruno Silva\"},\"activeOpportunities\":1}\n"
				}
			]
		},
			{
				"name": "SQL Example 3: Contact + Opportunity + PPO (recursive)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"sql\": \"SELECT ct.code, ct.name, o.code AS opp_code, o.status AS opp_status, o.label, ppo.status AS ppo_status, ppo.rating, ppo.product FROM Contact ct INNER JOIN Opportunity o ON ct._id = o.contact._id INNER JOIN ProductsPerOpportunities ppo ON o._id = ppo.opportunity._id WHERE ct.status = 'active' AND o.status IN ('Nova', 'Em Visitacao') ORDER BY o._createdAt DESC LIMIT 100\",\n  \"includeMeta\": true\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/sql",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "sql"]
					},
				"description": "RFC-0001 SQL equivalent of Example 3: 3-level chain Contact -> Opportunity -> ProductsPerOpportunities."
			},
			"response": [
				{
					"name": "200 OK - NDJSON (nested)",
					"status": "OK",
					"code": 200,
					"header": [
						{ "key": "Content-Type", "value": "application/x-ndjson" },
						{ "key": "X-Total-Count", "value": "1" }
					],
					"body": "{\"_meta\":{\"success\":true,\"document\":\"Contact\",\"relations\":[\"Opportunity\",\"ProductsPerOpportunities\"],\"warnings\":[],\"executionTimeMs\":450,\"total\":1}}\n{\"code\":1001,\"name\":{\"full\":\"Alice Santos\"},\"opportunityCount\":2,\"opportunities\":[{\"code\":5001,\"status\":\"Nova\",\"label\":\"Apt 301\",\"productCount\":2,\"products\":[{\"status\":\"Ofertado\",\"rating\":4},{\"status\":\"Visitado\",\"rating\":5}]},{\"code\":5002,\"status\":\"Em Visitacao\",\"label\":\"Casa 12\",\"productCount\":0,\"products\":[]}]}\n"
				}
			]
		},
			{
				"name": "SQL Example 4: Activity + Product (LEFT JOIN)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"sql\": \"SELECT a.code, a.subject, a.status, FIRST(p.code) AS productCode, FIRST(p.sale) AS productSale FROM Activity a LEFT JOIN Product p ON a.product._id = p._id WHERE a.status IN ('new', 'in-progress') ORDER BY a._createdAt DESC LIMIT 200\",\n  \"includeMeta\": true\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/sql",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "sql"]
					},
				"description": "RFC-0001 SQL equivalent of Example 4: Activities with optional product (LEFT JOIN). Activities without product get null for product aggregators."
			},
			"response": [
				{
					"name": "200 OK - NDJSON (nulls for missing product)",
					"status": "OK",
					"code": 200,
					"header": [
						{ "key": "Content-Type", "value": "application/x-ndjson" },
						{ "key": "X-Total-Count", "value": "2" }
					],
					"body": "{\"_meta\":{\"success\":true,\"document\":\"Activity\",\"relations\":[\"Product\"],\"warnings\":[],\"executionTimeMs\":85,\"total\":2}}\n{\"code\":8001,\"subject\":\"Call about apartment\",\"status\":\"in-progress\",\"productCode\":123,\"productSale\":{\"value\":450000,\"currency\":\"BRL\"}}\n{\"code\":8002,\"subject\":\"Follow-up email\",\"status\":\"new\",\"productCode\":null,\"productSale\":null}\n"
				}
			]
		},
			{
				"name": "SQL Example 5: Campaign + Opportunity (count + first + avg)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"sql\": \"SELECT c.code, c.name, c.type, COUNT(o._id) AS totalOpportunities, FIRST(o.*) AS newestOpportunity, AVG(o.value) AS avgValue FROM Campaign c INNER JOIN Opportunity o ON c._id = o.campaign._id WHERE c.status = 'Ativo' GROUP BY c.code, c.name, c.type ORDER BY o._createdAt DESC LIMIT 50\",\n  \"includeMeta\": true\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/sql",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "sql"]
					},
				"description": "RFC-0001 SQL equivalent of Example 5: Campaign performance with count, first, and avg aggregators."
			},
			"response": [
				{
					"name": "200 OK - NDJSON",
					"status": "OK",
					"code": 200,
					"header": [
						{ "key": "Content-Type", "value": "application/x-ndjson" },
						{ "key": "X-Total-Count", "value": "3" }
					],
					"body": "{\"_meta\":{\"success\":true,\"document\":\"Campaign\",\"relations\":[\"Opportunity\"],\"warnings\":[],\"executionTimeMs\":180,\"total\":3}}\n{\"code\":301,\"name\":\"Summer 2026\",\"type\":\"Digital\",\"totalOpportunities\":45,\"newestOpportunity\":{\"_id\":\"o99\",\"code\":5099,\"status\":\"Nova\",\"label\":\"Lead #5099\"},\"avgValue\":250000}\n"
				}
			]
		},
			{
				"name": "SQL Example 6: Contact + Message (max + count)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"sql\": \"SELECT ct.code, ct.name, MAX(m._createdAt) AS lastEmailSentAt, COUNT(m._id) AS totalEmailsSent FROM Contact ct LEFT JOIN Message m ON ct._id = m.contact._id WHERE m.type = 'Email' AND m.status = 'Enviada' GROUP BY ct.code, ct.name ORDER BY ct.name ASC LIMIT 1000\",\n  \"includeMeta\": true\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/sql",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "sql"]
					},
				"description": "RFC-0001 SQL equivalent of Example 6: Last email sent and total emails per contact."
			},
			"response": [
				{
					"name": "200 OK - NDJSON",
					"status": "OK",
					"code": 200,
					"header": [
						{ "key": "Content-Type", "value": "application/x-ndjson" },
						{ "key": "X-Total-Count", "value": "3" }
					],
					"body": "{\"_meta\":{\"success\":true,\"document\":\"Contact\",\"relations\":[\"Message\"],\"warnings\":[],\"executionTimeMs\":150,\"total\":3}}\n{\"code\":1001,\"name\":{\"full\":\"Alice Santos\"},\"lastEmailSentAt\":\"2026-02-09T14:30:00.000Z\",\"totalEmailsSent\":12}\n{\"code\":1002,\"name\":{\"full\":\"Bruno Silva\"},\"lastEmailSentAt\":\"2026-01-15T09:00:00.000Z\",\"totalEmailsSent\":3}\n{\"code\":1003,\"name\":{\"full\":\"Carlos Mendes\"},\"lastEmailSentAt\":null,\"totalEmailsSent\":0}\n"
				}
			]
		},
			{
				"name": "Invalid SQL (syntax error)",
				"request": {
					"method": "POST",
					"header": [
						{ "key": "Content-Type", "value": "application/json" }
					],
					"body": {
						"mode": "raw",
						"raw": "{\n  \"sql\": \"SELECT c.code FROM Contact c WHERE c INVALID\"\n}"
					},
					"url": {
						"raw": "{{baseUrl}}/rest/query/sql",
						"host": ["{{baseUrl}}"],
						"path": ["rest", "query", "sql"]
					},
				"description": "Negative test: Invalid SQL should return 400 with parser/validation error."
			},
			"response": [
				{
					"name": "400 Bad Request - Parse error",
					"status": "Bad Request",
					"code": 400,
					"header": [
						{ "key": "Content-Type", "value": "application/x-ndjson" }
					],
					"body": "{\"_meta\":{\"success\":false,\"errors\":[{\"message\":\"SQL syntax error: ...\"}]}}"
				}
			]
		}
		]
	}
],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "authToken",
			"value": "",
			"type": "string",
			"description": "Token from Login response (authId). Set after running Login or paste your session token."
		}
	]
}

